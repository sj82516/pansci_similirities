我們已經在前兩期的專欄中（2013年1月號、2013年3月號）介紹如何用Android手機上的姿態感測器來控制樂高機器人。搭配手機的感測器，您可以像玩Wii遊戲機一樣，以體感的方式來與機器人互動。本次專欄將使用App Inventor中的TextToSpeech元件（本文後簡稱TTS元件），讓手機「說」出機器人感測器的狀態（圖1）。程式執行的過程中，我們還可以即時更改感測器的類型，是很實用的功能呢！
App Inventor的TextToSpeech元件可以讓Android手機以語音方式輸出指定的文字或數值內容，本範例就是讓手機每秒播報一次感測器數值。除此之外還可指定語系與國家，預設值是eng（英語）與USA（美國），代表美式英語。您可以參考App Inventor中文學習網來改為其他歐陸語系，例如德語、法語或義大利語，會有更有趣的效果。
請注意！目前App Inventor不支援中文等亞洲語系的語音輸出。
開始玩機器人
請把NXT機器人組裝好，並將左側馬達接在NXT的輸出端B，右側則是輸出端C（註1）。請確認NXT主機的藍牙是啟動的，接著將NXT主機與Android手機進行藍牙配對（註2），完成之後就可以把機器人放到一邊了。啟動藍牙之後您可以從NXT主機的螢幕左上角看到藍牙的符號。
接下來依序介紹程式的各個功能：
STEP1 登入畫面：
首次進入程式的畫面如圖2a，只有「NXT裝置清單/連線」按鈕可以按，其它所有按鈕都無法操作。點選[NXT裝置清單/連線]按鈕後進入藍牙裝置清單（圖2b），請找到剛剛配對完成的NXT主機名稱（本範例為abc），點選之後就會由Android裝置對NXT主機發起藍牙連線。順利連線成功的話，就可接續選擇感測器類型（圖2c）。
STEP2 程式初始化：
在點選連線清單之前（ListPickerConnect的BeforePicking事件），需先將清單內容指定為Android裝置上的藍牙配對清單（圖3a）。點選之後則先測試連線是否成功，成功則將「選擇感測器」與「開始念/停止」設為可點選（圖3b）。
STEP3 選擇感測器類型：
為了節省畫面空間，我們使用了Listpicker搭配清單來達到下拉式選單的效果。首先需要宣告一個清單，內容為（color.jpg, sound.jpg, light.jpg, ultra.jpg），就是使用的感測器圖檔名稱（圖4a）。編號index則依序由1到4。本範例就是使用這個編號來更改顯示的圖片與感測器類型。
由圖4b中可看到當我們點選了要使用的感測器之後，就要把「開始念/停止」按鈕設為可點選，代表我們準備好要念出感測器數值了。另外還把這個編號所代表的項目內容顯示在畫面上，最後則將Image元件的圖片換成這個編號所代表的圖檔（select list item指令）。例如圖4a中的sensorList清單中的第3號的項目內容就是「light.jpg」。
注意！List清單實際上就是一般程式語言中的陣列（array），App Inventor使用了較為親民的用語。另外n個項目的陣列其項目編號是由0到n-1，App Inventor則是1到n。
STEP4 根據選擇的感測器類型來控制TTS元件播報內容：
選擇感測器類型，實際上就是在ListPicker_SensorList中點選了某個項目，接著就要根據這個項目的編號index（請注意，不是項目內容！）來決定TTS元件的播報內容。在此我們使用一個副程式say來管理程式，讓程式更簡明易懂。在say副程式中，它會藉由接收到的sensor參數（也就是傳入的編號index）來決定TTS元件的播報內容與TextBox/Label的顯示內容。請看圖5說明：
STEP5 使用Clock元件來控制TTS元件：
我們將Clock元件的TimerInterval設定為2000毫秒，代表每兩秒呼叫一次say副程式，並傳入剛才所點選的感測器類型編號（SelectionIndex）。這樣就能控制TTS元件的播報內容與TextBox/Label的顯示內容（圖6）。
STEP6 開始/停止播報感測器數值：
如果在尚未建立與機器人的藍牙連線之前就要TTS念些什麼的話，就會得到-1 這個討厭的數值。所以我們使用「開始念/停止」按鈕來啟動或關閉Clock元件，並將現在的播報狀態（STOP！或SPEAKING！）顯示在手機的狀態列。您可以隨時用這個按鈕來決定停止或繼續播報資料（圖7）。
STEP7 斷線：
按下「斷線」按鈕之後，會中止藍牙連線（BluetoothClient.Disconnect指令），並使按鈕恢復到未連線時的狀態（圖8）。
操作
實際執行的時候，請先確認NXT已經開機且藍牙也啟動了，並將顏色、聲音、光與超音波感測器依序接在NXT主機的1到4號輸入端。接著在您的Android裝置上點選程式畫面中的「連線」按鈕，會進到如圖4b的藍牙清單畫面，點選您所要的NXT主機名稱並連線成功後，接著選擇感測器類型，點選之後會顯示對應的感測器圖片與名稱，如圖9所示。
最後點選旁邊的「開始念/停止」按鈕就可以聽到手機把感測器數值念出來了。以下是選擇超音波感測器時的畫面，畫面也會同時顯示數值為58（圖10）。
TTS元件是用來語音輸出的元件，它可以說出我們所指定的內容，包括文字與數字。您可以讓機器人用說的方式來呈現它的狀況，例如撞到牆壁時，可以說出「Ouch!」等趣味效果。期待您從本期專欄的內容來激盪出更多有趣的火花。請繼續關注CAVE的機器人專欄唷！
歡迎大家由此連結下載本程式來玩玩看，或掃描以下的QRCode也可以直接將檔案下載到手機。或到App Inventor中文教學網上直接下載本範例的App Inventor原始檔與apk安裝檔。本程式已上架Google play，請到Google Play搜尋「CAVE教育團隊」就找得到我們的樂高機器人系列app了。
註1：想學如何開發App Inventor程式嗎？請到App Inventor中文學習網與我們一同學習。
註2：將Android手機設定為可安裝非Google Play下載的程式以及讓手機與樂高NXT主機連線等說明請參考此連結。
註3：與NXT連線後如果出現[Error 402]之錯誤訊息請不必理會，程式依然能正確執行。
文章原文刊載於《ROBOCON》國際中文版2013/5月號
2017 年泛知識節 早腦人必搶的早鳥優惠開跑啦！
「3 大領域 x 150 場分享、體驗、工作坊 x 200 個意見領袖 x 1000 個參與者」2017 年兩岸三地最大知識饗宴 – “泛・知識節" 早鳥票開賣啦！
由泛科知識旗下 PanSci 科學新聞網、 娛樂重擊 Punchline、PanX 泛科技新聞網聯合超強協力夥伴，邀你在兩天內火拼知識，替自己的大腦做個版本升級。11月 11&12 日到泛．知識節直搗知識核心，挑戰與創造未知 ∞ 種可能！手腳迅速，眼光精準的早腦人如你，還不速速搶下早鳥優惠及獨家周邊商品！（購票還贈 TAAZE 讀冊生活折價卷）
>>早鳥優惠只到 10/27<<